{% extends 'base.html' %}
{% load staticfiles %}
{% load crispy_forms_tags %}

{% block content %}
    <div class="panel panel-primary">
        <div class="panel-heading">Panel heading without title</div>
            <div class="panel-body">
                <div class="row">
                    {% crispy form form.helper %}
                </div>
            </div>
        </div>
    </div>
    <div id="donor_with_num_of_grants_chart" style="width:100%; "></div>
    <div id="donor_with_num_of_grants" style="display: none;">{{ donors }}</div>
{% endblock content %}

{% block extra_js %}
<script type="text/javascript">

$(document).ready(function() {
    var donors = $.parseJSON($("#donor_with_num_of_grants").html());
    var donor_names = [];
    var donor_grants = [];
    var i = 0;
    $.each(donors, function(k,v) {
        donor_names[i] = v.name;
        donor_grants[i] = v.num_grants;
        i++;
    });
    $('#donor_with_num_of_grants_chart').highcharts({
        chart: {
            type: 'column',
            renderTo: 'donor_with_num_of_grants_chart',
            spacingBottom: 0,
        },
        title: {
            text: 'Grants per Donor'
        },
        subtitle: {
            text: 'Source: <a href="https://gait.mercycorps.org" target="_blank">Grant & Award Information Tracker</a>'
        },
        xAxis: {
            categories: donor_names,
            title: {
                text: "Donors"
            }
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Number of Grants',
                align: 'high'
            }
        },
        plotOptions: {
            column: {
                pointPadding: 0.2,
                borderWidth: 0,
                dataLabels: {
                    enabled: true,
                }
            }
        },
        legend: {
            enabled: true
        },
        series: [
            {
                name: "Grants per Donor",
                colorByPoint: true,
                data: donor_grants
            }
        ]
    });
});

</script>
{% endblock %}